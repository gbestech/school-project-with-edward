<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ student.name }} - Nursery Term Report</title> 
</head>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    @page {
        size: A4;
        margin: 8mm;
    }

    @media print {
        body {
            margin: 0;
            padding: 0;
        }
        .container {
            box-shadow: none;
            margin: 0;
            padding: 12mm;
        }
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #2c3e50;
        background-color: #f8f9fa;
        font-size: 9px;
        line-height: 1.3;
    }

    .container {
        max-width: 210mm;
        margin: 10px auto;
        padding: 12mm;
        background: white;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
        position: relative;
    }

    /* Elegant Watermark */
    .watermark {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0.03;
        pointer-events: none;
        z-index: 1;
    }

    .watermark-circle {
        width: 400px;
        height: 400px;
        border: 3px solid #3498db;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 42px;
        font-weight: 900;
        color: #3498db;
        letter-spacing: 4px;
    }

    .content {
        position: relative;
        z-index: 10;
    }

    /* Elegant Header */
    .header {
        border-bottom: 3px solid #3498db;
        margin-bottom: 12px;
        padding-bottom: 10px;
    }

    .header-top {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
    }

    .logo-section {
        flex-shrink: 0;
    }

    .school-logo {
        width: 55px;
        height: 55px;
        object-fit: contain;
        border-radius: 50%;
        border: 2px solid #3498db;
        padding: 3px;
        background: white;
    }

    .logo-placeholder {
        width: 55px;
        height: 55px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 9px;
    }

    .school-info {
        flex: 1;
        text-align: center;
    }

    .school-name {
        font-size: 18px;
        font-weight: 900;
        color: #2c3e50;
        margin-bottom: 3px;
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .school-details {
        font-size: 7.5px;
        color: #7f8c8d;
        line-height: 1.4;
    }

    .school-motto {
        font-style: italic;
        color: #3498db;
        font-weight: 600;
        margin-top: 2px;
    }

    .report-banner {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        text-align: center;
        padding: 5px;
        margin: 8px -12mm 12px -12mm;
        font-weight: 700;
        font-size: 10px;
        letter-spacing: 1.5px;
        text-transform: uppercase;
    }

    .session-info {
        text-align: center;
        font-size: 8px;
        color: #7f8c8d;
        margin-top: -8px;
        margin-bottom: 10px;
    }

    /* Student Info Grid */
    .student-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 6px 10px;
        margin-bottom: 10px;
        font-size: 8px;
    }

    .info-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .info-label {
        font-weight: 700;
        color: #3498db;
        white-space: nowrap;
    }

    .info-value {
        flex: 1;
        border-bottom: 1px dotted #bdc3c7;
        color: #2c3e50;
        font-weight: 600;
        padding-bottom: 1px;
    }

    /* Section Headers */
    .section-header {
        background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
        color: #2c3e50;
        font-weight: 700;
        font-size: 9px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 4px 8px;
        margin: 10px 0 6px 0;
        border-left: 4px solid #3498db;
    }

    /* Compact Table */
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 8px;
        margin-bottom: 10px;
    }

    thead {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
    }

    th {
        padding: 5px 3px;
        text-align: center;
        font-weight: 700;
        font-size: 7.5px;
        border: 1px solid #2980b9;
        line-height: 1.2;
    }

    td {
        padding: 5px 4px;
        border: 1px solid #e0e0e0;
        text-align: center;
    }

    .subject-name {
        text-align: left;
        font-weight: 600;
        color: #2c3e50;
        background: #f8f9fa;
        padding-left: 6px;
    }

    .score-value {
        font-weight: 700;
        color: #3498db;
    }

    tbody tr:hover {
        background: #f1f8ff;
    }

    /* Two Column Layout */
    .two-col {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 10px;
    }

    /* Summary Box */
    .summary-box {
        border: 2px solid #3498db;
        border-radius: 6px;
        padding: 8px;
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
    }

    .summary-title {
        font-size: 9px;
        font-weight: 700;
        color: #3498db;
        margin-bottom: 6px;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 3px 0;
        font-size: 8px;
        border-bottom: 1px dotted #e0e0e0;
    }

    .summary-row:last-child {
        border-bottom: none;
    }

    .summary-label {
        color: #7f8c8d;
        font-weight: 600;
    }

    .summary-value {
        color: #2c3e50;
        font-weight: 700;
    }

    /* Development Table */
    .dev-box {
        border: 2px solid #3498db;
        border-radius: 6px;
        overflow: hidden;
        background: white;
    }

    .dev-title {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 5px;
        font-size: 9px;
        font-weight: 700;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .dev-box table {
        margin: 0;
        font-size: 7.5px;
    }

    .dev-box td {
        padding: 4px 6px;
    }

    .dev-box td:first-child {
        background: #f8f9fa;
        font-weight: 600;
        text-align: left;
        color: #2c3e50;
    }

    .dev-box td:last-child {
        font-weight: 700;
        color: #3498db;
    }

    /* Height & Weight */
    .hw-box {
        border: 2px solid #3498db;
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 10px;
    }

    .hw-title {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 4px;
        font-size: 8px;
        font-weight: 700;
        text-align: center;
        text-transform: uppercase;
    }

    .hw-box table {
        margin: 0;
        font-size: 7.5px;
    }

    .hw-box th {
        background: #ecf0f1;
        color: #2c3e50;
        padding: 3px;
        font-size: 7px;
    }

    .hw-box td {
        padding: 4px;
        font-weight: 600;
    }

    /* IMPROVED REMARKS SECTION */
    .remarks-section {
        margin-top: 12px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    .remark-box {
        border: 2px solid #3498db;
        border-radius: 6px;
        overflow: hidden;
        background: white;
        display: flex;
        flex-direction: column;
    }

    .remark-title {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 5px 8px;
        font-size: 8px;
        font-weight: 700;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .remark-content {
        padding: 8px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .remark-text {
        font-size: 7.5px;
        color: #2c3e50;
        line-height: 1.5;
        margin-bottom: 8px;
        min-height: 45px;
        flex: 1;
        border-bottom: 1px solid #ecf0f1;
        padding-bottom: 6px;
    }

    .signature-block {
        margin-top: auto;
    }

    .signature-label {
        font-size: 7px;
        color: #7f8c8d;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .signature-image {
        max-width: 240px;
        max-height: 90px;
        display: block;
        margin: 4px 0;
        border-bottom: 1px solid #bdc3c7;
        padding-bottom: 2px;
    }

    .signature-placeholder {
        height: 35px;
        border-bottom: 1px solid #bdc3c7;
        margin: 4px 0;
    }

    .signature-date {
        font-size: 9px;
        color: #95a5a6;
        margin-top: 2px;
    }

    /* Footer */
    .footer {
        text-align: center;
        font-size: 7px;
        color: #95a5a6;
        padding-top: 6px;
        border-top: 1px solid #ecf0f1;
        margin-top: 10px;
    }

    /* Attendance Box */
    .attendance-box {
        border: 2px solid #3498db;
        border-radius: 6px;
        padding: 6px 8px;
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
        text-align: center;
        margin-bottom: 10px;
    }

    .attendance-title {
        font-size: 8px;
        font-weight: 700;
        color: #3498db;
        margin-bottom: 4px;
        text-transform: uppercase;
    }

    .attendance-value {
        font-size: 11px;
        font-weight: 700;
        color: #2c3e50;
    }
</style>

<body>
    <div class="container">
        <!-- Watermark -->
        <div class="watermark">
            <div class="watermark-circle">
                {{ school.name|slice:":3"|upper }}
            </div>
        </div>

        <!-- Main Content -->
        <div class="content">
            <div class="header">
                <div class="header-top">
                    <div class="logo-section">
                        {% if school.logo %}
                            <img src="{{ school.logo }}" alt="School Logo" class="school-logo">
                        {% else %}
                            <div class="logo-placeholder">LOGO</div>
                        {% endif %}
                    </div>
                    <div class="school-info">
                        <div class="school-name">{{ school.name|upper }}</div>
                        <div class="school-details">  
                            <p>{{ school.address }}</p>
                            <p>{{ school.phone }} | {{ school.email }}</p>
                        </div>
                        {% if school.motto %}
                            <div class="school-motto">{{ school.motto }}</div>
                        {% endif %}
                    </div>
                    <div class="logo-section"></div>
                </div>
            </div>

            <div class="report-banner">Nursery School Termly Report Card</div>
            <div class="session-info">{{ term.name }} Term, {{ term.session }} Academic Session</div>

            <!-- Student Info -->
            <div class="student-grid">
                <div class="info-item">
                    <span class="info-label">NAME:</span>
                    <span class="info-value">{{ student.name|upper }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">CLASS:</span>
                    <span class="info-value">{{ student.class }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">AGE:</span>
                    <span class="info-value">{{ student.age|default:"N/A" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ADMISSION NO:</span>
                    <span class="info-value">{{ student.admission_number }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">POSITION:</span>
                    <span class="info-value">{{ summary.position }} of {{ summary.total_students }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">NEXT TERM:</span>
                    <span class="info-value">{{ next_term_begins }}</span>
                </div>
            </div>

            <!-- Academic Performance -->
            <div class="section-header">ðŸ“š Academic Performance</div>
            <table>
                <thead>
                    <tr>
                        <th style="text-align: left; width: 30%;">SUBJECT</th>
                        <th style="width: 12%;">MARKS</th>
                        <th style="width: 12%;">MAX</th>
                        <th style="width: 12%;">%</th>
                        <th style="width: 10%;">GRADE</th>
                        <th style="width: 12%;">POSITION</th>
                        <th style="width: 12%;">REMARK</th>
                    </tr>
                </thead>
                <tbody>
                    {% for subject in subjects %}
                    <tr>
                        <td class="subject-name">{{ subject.name }}</td>
                        <td class="score-value">{{ subject.mark_obtained|floatformat:0 }}</td>
                        <td>{{ subject.max_obtainable|floatformat:0 }}</td>
                        <td class="score-value">{{ subject.percentage|floatformat:1 }}%</td>
                        <td class="score-value">{{ subject.grade }}</td>
                        <td>{{ subject.position }}</td>
                        <td style="font-size: 7px;">{{ subject.remark|truncatewords:3 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Summary and Development -->
            <div class="two-col">
                <div class="summary-box">
                    <div class="summary-title">Performance Summary</div>
                    <div class="summary-row">
                        <span class="summary-label">Total Marks Obtained:</span>
                        <span class="summary-value">{{ summary.total_marks_obtained|floatformat:0 }}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Total Max Marks:</span>
                        <span class="summary-value">{{ summary.total_max_marks|floatformat:0 }}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Overall Percentage:</span>
                        <span class="summary-value">{{ summary.overall_percentage|floatformat:2 }}%</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Total Subjects:</span>
                        <span class="summary-value">{{ summary.total_subjects }}</span>
                    </div>
                </div>

                <div class="dev-box">
                    <div class="dev-title">Development & Conduct</div>
                    <table>
                        <tbody>
                            <tr>
                                <td>Physical Development</td>
                                <td>{{ development.physical|default:"Good" }}</td>
                            </tr>
                            <tr>
                                <td>Health Status</td>
                                <td>{{ development.health|default:"Good" }}</td>
                            </tr>
                            <tr>
                                <td>Cleanliness</td>
                                <td>{{ development.cleanliness|default:"Good" }}</td>
                            </tr>
                            <tr>
                                <td>General Conduct</td>
                                <td>{{ development.conduct|default:"Good" }}</td>
                            </tr>
                            <tr>
                                <td>Punctuality</td>
                                <td>{{ development.punctuality|default:"Very Good" }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Attendance -->
            <div class="attendance-box">
                <div class="attendance-title">Attendance Record</div>
                <div class="attendance-value">
                    {{ attendance.times_present }} / {{ attendance.times_opened }} Days Present
                </div>
            </div>

            <!-- Height & Weight -->
            <div class="hw-box">
                <div class="hw-title">Height & Weight Record</div>
                <table>
                    <thead>
                        <tr>
                            <th colspan="2">HEIGHT (cm)</th>
                            <th colspan="2">WEIGHT (kg)</th>
                        </tr>
                        <tr>
                            <th>Beginning</th>
                            <th>End of Term</th>
                            <th>Beginning</th>
                            <th>End of Term</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{{ measurements.height_beginning|default:"â€”" }}</td>
                            <td>{{ measurements.height_end|default:"â€”" }}</td>
                            <td>{{ measurements.weight_beginning|default:"â€”" }}</td>
                            <td>{{ measurements.weight_end|default:"â€”" }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Remarks Section - IMPROVED -->
            <div class="section-header">ðŸ’¬ Teacher's Remarks</div>
            <div class="remarks-section">
                <!-- Class Teacher Remark -->
                <div class="remark-box">
                    <div class="remark-title">Class Teacher's Comment</div>
                    <div class="remark-content">
                        <div class="remark-text">
                            {{ remarks.class_teacher|default:"Good progress observed throughout the term." }}
                        </div>
                        <div class="signature-block">
                            <div class="signature-label">Signature:</div>
                            {% if signatures.class_teacher.url %}
                                <img src="{{ signatures.class_teacher.url }}" 
                                     alt="Class Teacher Signature" 
                                     class="signature-image" />
                                {% if signatures.class_teacher.signed_at %}
                                    <div class="signature-date">Signed: {{ signatures.class_teacher.signed_at }}</div>
                                {% endif %}
                            {% else %}
                                <div class="signature-placeholder"></div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Head Teacher Remark -->
                <div class="remark-box">
                    <div class="remark-title">Head Teacher's Comment</div>
                    <div class="remark-content">
                        <div class="remark-text">
                            {{ remarks.head_teacher|default:"Keep up the good work and excellent behavior." }}
                        </div>
                        <div class="signature-block">
                            <div class="signature-label">Signature & Stamp:</div>
                            {% if signatures.head_teacher.url %}
                                <img src="{{ signatures.head_teacher.url }}" 
                                     alt="Head Teacher Signature" 
                                     class="signature-image" />
                                {% if signatures.head_teacher.signed_at %}
                                    <div class="signature-date">Signed: {{ signatures.head_teacher.signed_at }}</div>
                                {% endif %}
                            {% else %}
                                <div class="signature-placeholder"></div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                Report generated on {{ generated_date }} | This is an official school document. Please keep it safe for future reference.
            </div>
        </div>
    </div>
</body>
</html>